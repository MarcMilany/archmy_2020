Лучшие 25 команд брандмауэра UFW, которые должен знать каждый администратор Linux — читайте наш топ и становитесь специалистом IT!

https://blog.sedicomm.com/2020/03/31/luchshie-25-komand-brandmauera-ufw-kotorye-dolzhen-znat-kazhdyj-administrator-linux/

https://losst.pro/nastrojka-ufw-ubuntu

Содержание:
Что такое UFW?
Какая настройка по умолчанию для UFW Firewall?

Проверка версии Ubuntu Firewall
Проверка состояния брандмауэра Ubuntu
Проверка правил брандмауэра с номерами
Удаление правила брандмауэра UFW по его номеру
Включение брандмауэра Ubuntu
Отключение Ubuntu UFW Firewall
Проверка разрешений приложения через брандмауэр
Перезагрузка Linux UFW Firewall
Сброс UFW брандмауэр
Блокировка 80го порта трафика
Разрешение только TCP-соединений с портом 80
Запрет входящих UDP-соединений с портом 80
Запрет исходящего трафика NTP
Разрешение исходящего трафика NTP
Разрешение входящего трафика NTP
Разрешение трафика БД Oracle с определенного IP-адреса
Разрешение трафика БД Oracle из определенной подсети
Запрет трафика БД Oracle с определенного IP-адреса
Разрешение трафика БД MySQL из определенной подсети
Разрешение трафика БД Oracle на определенном сетевом интерфейсе
Запрет трафика БД Oracle на определенном сетевом интерфейсе
Ограничение SSH-соединения
Отклонение SSH-соединения на порту 22
Измена стандартной политики входящих сообщений
Измена стандартной политики по умолчанию
Некоторые дополнительные параметры брандмауэра UFW
 

В этой статье мы расскажем вам, как настроить брандмауэр UFW в Ubuntu 18.04. Вы можете задаться абсолютно адекватным вопросом, что такое UFW и зачем мы его используем? Что ж, ufw в основном действует как интерфейс для iptables и предназначен для упрощения процесса настройки брандмауэра. Теперь вы можете спросить, почему мы не используем брандмауэр iptables напрямую. Ответ на этот вопрос заключается в том, что iptables может создать некоторые трудности для начинающих при использовать его в полной мере, тогда как ufw делает жизнь новичка немного проще и помогает освоить брандмауэр в Linux.

 

 

Что такое UFW?
UFW часто называют Uncomplicated Firewall, который выступает в качестве интерфейса для легендарных iptables. Вы можете установить правила брандмауэра, используя UFW гораздо проще по сравнению с iptables.

 

 

Какая настройка по умолчанию для UFW Firewall?
Настройка по умолчанию означает, что по умолчанию UFW разрешает весь исходящий трафик и блокирует весь входящий трафик. При запуске системы UFW находиться в отключенном состоянии, если вы не включите его вручную.

Курсы Python с нуля до DevOps на практике за 1,5 часа
Top-25-ufw-firewall-commands-every-Linux-Admin-Should-Know-1

 

 

1. Проверка версии Ubuntu Firewall
Чтобы проверить версию брандмауэра Ubuntu, вам нужно запустить команду sudo ufw version.

sudo ufw version
1
test@localhost:~$ sudo ufw version
2
ufw 0.36
3
Copyright 2008-2015 Canonical Ltd.
 

 

2. Проверка состояния брандмауэра Ubuntu
Чтобы проверить состояние брандмауэра Ubuntu, вам нужно выполнить команду sudo ufw status. Вы увидите следующий вывод, брандмауэр отображается в неактивном состоянии, что означает, что он в настоящее время не фильтрует трафик:

1
test@localhost:~$ sudo ufw status
2
Status: inactive
 

 

3. Проверка правил брандмауэра с номерами
Если вы хотите проверить все правила, установленные в настоящее время в брандмауэре, и вывести их вместе с их нумерацией, вам нужно проверить состояние брандмауэра, выполнив команду sudo ufw status numbered. Эта команда особенно полезна, когда вы хотите удалить какое-то правило:

Курсы Git за час: руководство для начинающих DevOps / DevNet инженеров
1
test@localhost:~$ sudo ufw status numbered
2
Status: active
3
?
4
To Action From
5
-- ------ ----
6
[ 1] 886 DENY IN Anywhere
7
[ 2] 123 ALLOW OUT Anywhere (out)
8
[ 3] 123 ALLOW IN Anywhere
9
[ 4] 1521 DENY IN 10.126.254.8
10
[ 5] 1521 DENY IN 10.126.254.0/24
11
[ 6] 1521 on enp0s3 DENY IN Anywhere
12
[ 7] 886 (v6) DENY IN Anywhere (v6)
13
[ 8] 123 (v6) ALLOW OUT Anywhere (v6) (out)
14
[ 9] 123 (v6) ALLOW IN Anywhere (v6)
15
[10] 1521 (v6) on enp0s3 DENY IN Anywhere (v6)
 

 

4. Удаление правила брандмауэра UFW по его номеру
Если вы хотите удалить какое-либо правило брандмауэра, то самым простым способом будет удалить правило по его номеру. Вы можете использовать приведенную выше команду, чтобы узнать номер для каждого правила. Допустим, мы хотим удалить правило №3 — «123 ALLOW IN Anywhere», тогда мы выполним команду sudo ufw delete 3. Эта команда удалит правило 3 из брандмауэра, как показано ниже:

1
test@localhost:~$ sudo ufw delete 3
2
Deleting:
3
allow 123
4
Proceed with operation (y|n)? y
5
Rule deleted
 

 

5. Включение брандмауэра Ubuntu
Если вы хотите, чтобы брандмауэр начал фильтровать сетевой трафик, вам нужно включить и перевести его в активное состояние, выполнив команду sudo ufw enable:

1
test@localhost:~$ sudo ufw enable
2
Command may disrupt existing ssh connections. Proceed with operation (y|n)? y
3
Firewall is active and enabled on system startup
 

 

6. Отключение Ubuntu UFW Firewall
Если вы хотите отключить Ubuntu UFW Firewall, вам нужно использовать команду sudo ufw disable. Эта команда гарантирует, что брандмауэр не включится автоматически после перезагрузки системы:

$ sudo ufw disable
1
test@localhost:~$ sudo ufw disable
2
Firewall stopped and disabled on system startup
 

 

7. Проверка разрешений приложения через брандмауэр
Если вы хотите проверить все приложения, разрешенные в настоящее время через брандмауэр ufw, вам нужно использовать команду sudo ufw app list:

sudo ufw app list
1
test@localhost:~$ sudo ufw app list
2
Available applications:
3
CUPS
4
Nginx Full
5
Nginx HTTP
6
Nginx HTTPS
7
OpenSSH
 

 

8. Перезагрузка Linux UFW Firewall
Чтобы перезагрузить брандмауэр Linux UFW, вам нужно выполнить команду sudo ufw reload. Эта команда перезагрузит файл конфигурации ufw и примет обновленные изменения, сделанные в файле конфигурации:

sudo ufw reload
1
test@localhost:~$ sudo ufw reload
2
Firewall reloaded
 

ПРИМЕЧАНИЕ: Здесь важно понять разницу между аргументами reload и restart для команды ufw. Restart завершит все процессы и запустит их снова, в то время как Reload просто перезагрузит файл конфигурации. Поэтому, если вы сделали какие-либо недавние изменения в файле конфигурации, рекомендуется использовать именно аргумент reload для повторной загрузки файла конфигурации.

 

 

9. Сброс UFW брандмауэра
Если вы хотите сбросить ufw, вам нужно использовать команду sudo ufw reset. Эта команда в вернет брандмауэр ufw к настройкам по умолчанию:

sudo ufw reset
1
test@localhost:~$ sudo ufw reset
2
Resetting all rules to installed defaults. This may disrupt existing ssh
3
connections. Proceed with operation (y|n)? y
4
Backing up 'user.rules' to '/etc/ufw/user.rules.20200106_115143'
5
Backing up 'before.rules' to '/etc/ufw/before.rules.20200106_115143'
6
Backing up 'after.rules' to '/etc/ufw/after.rules.20200106_115143'
7
Backing up 'user6.rules' to '/etc/ufw/user6.rules.20200106_115143'
8
Backing up 'before6.rules' to '/etc/ufw/before6.rules.20200106_115143'
9
Backing up 'after6.rules' to '/etc/ufw/after6.rules.20200106_115143'
 

 

10. Блокировка 80-го порта трафика
Если вы хотите заблокировать 80 порт вместо блокировки конкретных приложений http, что в основном означает то же самое, вы можете выполнить команду sudo ufw deny 80:

$ sudo ufw deny 80
1
test@localhost:~$ sudo ufw deny 80
2
Rules updated
3
Rules updated (v6)
 

 

11. Разрешение только TCP-соединений с портом 80
Допустим, вы хотите разрешить только tcp-соединения с 80 портом, вы можете выполнить это, используя команду sudo ufw allow 80/tcp:

sudo ufw allow 80/tcp
1
test@localhost:~$ sudo ufw allow 80/tcp
2
Rule added
3
Rule added (v6)
 

 

12. Запрет входящих UDP-соединения с портом 80
Если вы хотите запретить входящие UDP-соединения с 80 портом, выполните команду sudo ufw deny 80/udp:

$ sudo ufw deny 80/udp
1
test@localhost:~$ sudo ufw deny 80/udp
2
Rule added
3
Rule added (v6)
 

 

13. Запрет исходящего трафик NTP
Если вы хотите запретить исходящий NTP-трафик, вы можете выполнить это с помощью команды sudo ufw deny out 123:

$ sudo ufw deny out 123
1
test@localhost:~$ sudo ufw deny out 123
2
Rules updated
3
Rules updated (v6)
 

 

14. Разрешение исходящего трафика NTP
Если вы хотите разрешить исходящий NTP-трафик через 123 порт, вы можете выполнить это с помощью команды sudo ufw allow out 123:

$ sudo ufw allow out 123
1
test@localhost:~$ sudo ufw allow out 123
2
Rules updated
3
Rules updated (v6)
 

 

15. Разрешение входящего трафика NTP
Если вы хотите разрешить входящий трафик NTP (Network Time Protocol), вам нужно выполнить команду sudo ufw allow 123:

$ sudo ufw allow 123
1
test@localhost:~$ sudo ufw allow 123
2
Rules updated
3
Rules updated (v6)
 

 

16. Разрешение трафика БД Oracle с определенного IP-адреса
Если вы хотите разрешить трафик БД Oracle с IP-адреса 10.126.254.8, то вам нужно выполнить следующую команду:

sudo ufw allow from 10.126.254.8 to any port 1521
1
test@localhost:~$ sudo ufw allow from 10.126.254.8 to any port 1521
2
Rules updated
 

 

17. Разрешение трафика БД Oracle из определенной подсети
Если вы хотите разрешить трафик БД Oracle из определенной подсети, скажем, 10.126.254.0/24, то вам нужно использовать приведенную ниже команду:

Rules updated
1
test@localhost:~$ sudo ufw allow from 10.126.254.0/24 to any port 1521
2
Rules updated
 

 

18. Запрет трафика БД Oracle с определенного IP-адреса
Если вы хотите запретить трафик БД Oracle из определенной подсети, скажем, 10.126.254.0/24, то вам нужно выполнить команду приведённую ниже:

sudo ufw deny from 10.126.254.8 to any port 1521
1
test@localhost:~$ sudo ufw deny from 10.126.254.8 to any port 1521
2
Rules updated
 

 

19. Разрешение трафика БД MySQL из определенной подсети
Если вы хотите разрешить трафик БД MySQL из определенной подсети, скажем, 10.126.254.0/24, то вам нужно выполнить следующую команду:

$ sudo ufw deny from 10.126.254.0/24 to any port 3389
1
test@localhost:~$ sudo ufw deny from 10.126.254.0/24 to any port 3389
2
Rules updated
 

 

20. Разрешение трафик БД Oracle на определенный сетевой интерфейс
Если вы хотите разрешить трафик БД Oracle для определенного интерфейса, скажем, enp0s3 в этом случае, то вам нужно выполнить следующую команду:

1
test@localhost:~$ sudo ufw allow in on enp0s3 to any port 1521
2
Rules updated
3
Rules updated (v6)
 

 

21. Запрет трафика БД Oracle на определенный сетевой интерфейс
Если вы хотите запретить трафика БД Oracle на интерфейс enp0s3, вы можете сделать это с помощью команды приведённой ниже:

1
test@localhost:~$ sudo ufw deny in on enp0s3 to any port 1521
2
Rules updated
3
Rules updated (v6)
 

 

22. Ограничение SSH-соединения
Чтобы ограничить соединения ssh до 6 в течение 30 секунд, используйте команду sudo ufw limit ssh. Иногда это может помочь в предотвращении атак DOS:

1
test@localhost:~$ sudo ufw limit ssh
2
Rule added
3
Rule added (v6)
 

 

23. Отключение SSH-соединения на порту 22
Иногда вам может потребоваться отклонить некоторые подключения и отправлять уведомление об отклонении отправителю всякий раз, когда он пытается подключиться к определенному порту, например, к порту 22, в нашем случае:

1
test@localhost:~$ sudo ufw reject 22
2
Rule added
3
Rule added (v6)
 

 

24. Изменение стандартной внутренней политики
Если вы хотите изменить стандартную внутреннюю политику, вам нужно выполнить команду sudo ufw default deny incoming:

sudo ufw default deny incoming
1
test@localhost:~$ sudo ufw default deny incoming
2
Default incoming policy changed to 'deny'
3
(be sure to update your rules accordingly)
 

 

25. Изменение стандартной внешней политики
Если вы хотите изменить стандартную внешнюю политику,то вы можете выполнить это, используя команду sudo ufw default allow outgoing:

sudo ufw default allow outgoing
1
test@localhost:~$ sudo ufw default allow outgoing
2
Default outgoing policy changed to 'allow'
3
(be sure to update your rules accordingly)
 

 

26. Некоторые дополнительные параметры брандмауэра UFW
Параметры	Описание
—version	показать номер версии программы и выйти
-h, —help	показать справочное сообщение и выйти
—dry-run	ничего не изменять, просто показать изменения
enable	перезагрузка брандмауэра и включение брандмауэра при загрузке
disable	выгрузка межсетевого экрана и отключение его при загрузке
reload	перезагрузка брандмауэр
default	allow|deny|reject DIRECTION
изменение политики по умолчанию для трафика направляющегося по DIRECTION, где DIRECTION является одним из входящих, исходящих или маршрутизируемых направлений. Обратите внимание, что существующие правила должны переноситься вручную при изменении политики по умолчанию. Смотрите RULE SYNTAX, чтобы узнать больше об отрицании и отклонении
logging	on|off|LEVEL
включение/отключение регистрации. Зарегистрированные пакеты используют средство системного журнала LOG_KERN. Системы, настроенные для поддержки rsyslog, также могут войти в /var/log/ufw.log. Определение
LEVEL включает вход в систему для указанного LEVEL. LEVEL журнала по умолчанию — «low».
show REPORT	отображает информацию о работающем брандмауэре. Смотрите REPORTS
allow ARGS	добавить разрешающее правило
deny ARGS	добавить запрещающее правило
reject ARGS	добавить отклоняющее правило
limit ARGS	добавить правило ограничения. В настоящее время поддерживается только IPv4.
delete RULE|NUM	удаляет соответствующее RULE
insert NUM RULE	вставить соответствующее RULE как номер правила NUM
 

 

Спасибо за уделенное время на прочтение статьи!